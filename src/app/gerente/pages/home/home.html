<div class="home-container">
  <!-- Header -->
  <app-header (sidebarToggle)="toggleSidebar()"></app-header>
  
  <!-- Sidebar -->
  <app-sidebar [isCollapsed]="sidebarCollapsed" [showMobileOverlay]="showMobileSidebar"></app-sidebar>
  
  <!-- Main Content -->
  <main class="main-content" [class.sidebar-collapsed]="sidebarCollapsed">
    <div class="content-wrapper">
      <!-- Page Header -->
      <div class="page-header">
        <div class="header-content">
          <h1 class="page-title">Dashboard</h1>
          <p class="page-subtitle">Visão geral do seu restaurante</p>
        </div>
        <div class="header-actions">
          <button class="btn-secondary" (click)="refreshData()">
            <span class="material-icons">refresh</span>
            Atualizar
          </button>
          <button class="btn-primary" (click)="exportReport()">
            <span class="material-icons">download</span>
            Exportar
          </button>
        </div>
      </div>

      <!-- Metrics Cards -->
      <div class="metrics-grid" *ngIf="dashboardMetrics">
        <div class="metric-card">
          <div class="metric-icon orders">
            <span class="material-icons">shopping_cart</span>
          </div>
          <div class="metric-content">
            <h3 class="metric-value">{{ dashboardMetrics.todayOrders }}</h3>
            <p class="metric-label">Pedidos Hoje</p>
            <div class="metric-change" [class.positive]="dashboardMetrics.ordersComparison > 0" [class.negative]="dashboardMetrics.ordersComparison < 0">
              <span class="material-icons">{{ dashboardMetrics.ordersComparison > 0 ? 'trending_up' : 'trending_down' }}</span>
              {{ Math.abs(dashboardMetrics.ordersComparison) }}% vs ontem
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon revenue">
            <span class="material-icons">attach_money</span>
          </div>
          <div class="metric-content">
            <h3 class="metric-value">R$ {{ dashboardMetrics.todayRevenue | number:'1.2-2' }}</h3>
            <p class="metric-label">Receita Hoje</p>
            <div class="metric-change" [class.positive]="dashboardMetrics.revenueComparison > 0" [class.negative]="dashboardMetrics.revenueComparison < 0">
              <span class="material-icons">{{ dashboardMetrics.revenueComparison > 0 ? 'trending_up' : 'trending_down' }}</span>
              {{ Math.abs(dashboardMetrics.revenueComparison) }}% vs ontem
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon dishes">
            <span class="material-icons">restaurant_menu</span>
          </div>
          <div class="metric-content">
            <h3 class="metric-value">{{ dashboardMetrics.todayDishesCount }}</h3>
            <p class="metric-label">Pratos Vendidos</p>
            <div class="metric-change" [class.positive]="dashboardMetrics.dishesComparison > 0" [class.negative]="dashboardMetrics.dishesComparison < 0">
              <span class="material-icons">{{ dashboardMetrics.dishesComparison > 0 ? 'trending_up' : 'trending_down' }}</span>
              {{ Math.abs(dashboardMetrics.dishesComparison) }}% vs ontem
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon average">
            <span class="material-icons">calculate</span>
          </div>
          <div class="metric-content">
            <h3 class="metric-value">R$ {{ getAverageOrderValue() | number:'1.2-2' }}</h3>
            <p class="metric-label">Ticket Médio</p>
            <div class="metric-change positive">
              <span class="material-icons">trending_up</span>
              5.2% vs ontem
            </div>
          </div>
        </div>
      </div>

      <!-- Charts and Data -->
      <div class="dashboard-grid">

        <!-- Top Dishes -->
        <div class="dashboard-card">
          <div class="card-header">
            <h3 class="card-title">Pratos Mais Vendidos</h3>
            <a routerLink="/dishes" class="view-all-link">Ver todos</a>
          </div>
          <div class="card-content">
            <div class="top-dishes-list" *ngIf="topDishes.length > 0">
              <div class="dish-item" *ngFor="let dish of topDishes; let i = index">
                <div class="dish-rank">{{ i + 1 }}</div>
                <img [src]="dish.image" [alt]="dish.name" class="dish-image">
                <div class="dish-info">
                  <h4 class="dish-name">{{ dish.name }}</h4>
                  <p class="dish-category">{{ dish.category }}</p>
                  <div class="dish-stats">
                    <span class="orders-count">{{ dish.ordersCount }} pedidos</span>
                    <span class="revenue">R$ {{ dish.revenue | number:'1.2-2' }}</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="loading-state" *ngIf="topDishes.length === 0">
              <span class="material-icons">restaurant</span>
              <p>Carregando pratos...</p>
            </div>
          </div>
        </div>



        <!-- Stock Alerts -->
        <div class="dashboard-card alerts-card">
          <div class="card-header">
            <h3 class="card-title">Alertas de Estoque</h3>
            <a routerLink="/stock" class="view-all-link">Ver estoque</a>
          </div>
          <div class="card-content">
            <div class="alerts-list" *ngIf="stockAlerts.length > 0">
              <div class="alert-item" *ngFor="let alert of stockAlerts" [class]="alert.type">
                <div class="alert-icon">
                  <span class="material-icons">{{ getAlertIcon(alert.type) }}</span>
                </div>
                <div class="alert-content">
                  <h4 class="alert-title">{{ alert.itemName }}</h4>
                  <p class="alert-message">{{ getAlertMessage(alert) }}</p>
                </div>
                <div class="alert-action">
                  <button class="btn-sm" (click)="handleAlert(alert)">
                    {{ alert.type === 'low_stock' ? 'Repor' : 'Ver' }}
                  </button>
                </div>
              </div>
            </div>
            <div class="no-alerts" *ngIf="stockAlerts.length === 0">
              <span class="material-icons">check_circle</span>
              <p>Nenhum alerta no momento</p>
            </div>
          </div>
        </div>

        <!-- Category Sales -->
        <div class="dashboard-card">
          <div class="card-header">
            <h3 class="card-title">Vendas por Categoria</h3>
          </div>
          <div class="card-content">
            <div class="category-sales" *ngIf="categorySales.length > 0">
              <div class="category-item" *ngFor="let category of categorySales">
                <div class="category-info">
                  <h4 class="category-name">{{ category.categoryName }}</h4>
                  <div class="category-stats">
                    <span class="orders">{{ category.ordersCount }} pedidos</span>
                    <span class="revenue">R$ {{ category.revenue | number:'1.2-2' }}</span>
                  </div>
                </div>
                <div class="category-progress">
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="category.percentage"></div>
                  </div>
                  <span class="percentage">{{ category.percentage }}%</span>
                </div>
              </div>
            </div>
            <div class="loading-state" *ngIf="categorySales.length === 0">
              <span class="material-icons">category</span>
              <p>Carregando categorias...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

