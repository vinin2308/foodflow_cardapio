<div class="categories-container">
  <!-- Header -->
  <app-header (sidebarToggle)="toggleSidebar()"></app-header>
  
  <!-- Sidebar -->
  <app-sidebar [isCollapsed]="sidebarCollapsed" [showMobileOverlay]="showMobileSidebar"></app-sidebar>
  
  <!-- Main Content -->
  <main class="main-content" [class.sidebar-collapsed]="sidebarCollapsed">
    <div class="content-wrapper">
      <!-- Page Header -->
      <div class="page-header">
        <div class="header-content">
          <h1 class="page-title">Gest√£o de Categorias</h1>
          <p class="page-subtitle">Organize o card√°pio do seu restaurante</p>
        </div>
        <div class="header-actions">
          <button class="btn-secondary" (click)="exportCategories()">
            <span class="material-icons">download</span>
            Exportar
          </button>
          <button class="btn-primary" (click)="openAddCategoryModal()">
            <span class="material-icons">add</span>
            Nova Categoria
          </button>
        </div>
      </div>

      <!-- Search and Filters -->
      <div class="filters-section">
        <div class="search-container">
          <div class="search-input-wrapper">
            <span class="material-icons search-icon">search</span>
            <input 
              type="text" 
              class="search-input" 
              placeholder="Buscar categorias..."
              [(ngModel)]="searchTerm"
              (input)="filterCategories()">
          </div>
        </div>
        
        <div class="filters-container">
          <select class="filter-select" [(ngModel)]="selectedStatus" (change)="filterCategories()">
            <option value="">Todos os status</option>
            <option value="active">Ativas</option>
            <option value="inactive">Inativas</option>
          </select>
          
          <button class="btn-outline" (click)="clearFilters()">
            <span class="material-icons">clear</span>
            Limpar Filtros
          </button>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon total">
            <span class="material-icons">category</span>
          </div>
          <div class="stat-content">
            <h3 class="stat-value">{{ categories.length }}</h3>
            <p class="stat-label">Total de Categorias</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon active">
            <span class="material-icons">check_circle</span>
          </div>
          <div class="stat-content">
            <h3 class="stat-value">{{ getActiveCategoriesCount() }}</h3>
            <p class="stat-label">Ativas</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon dishes">
            <span class="material-icons">restaurant_menu</span>
          </div>
          <div class="stat-content">
            <h3 class="stat-value">{{ getTotalDishesCount() }}</h3>
            <p class="stat-label">Total de Pratos</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon popular">
            <span class="material-icons">trending_up</span>
          </div>
          <div class="stat-content">
            <h3 class="stat-value">{{ getMostPopularCategory()?.name || 'N/A' }}</h3>
            <p class="stat-label">Mais Popular</p>
          </div>
        </div>
      </div>

      <!-- Categories Grid -->
      <div class="categories-section">
        <div class="section-header">
          <h2 class="section-title">Categorias Cadastradas</h2>
        </div>

        <!-- Categories Grid -->
        <div class="categories-grid" *ngIf="filteredCategories.length > 0">
          <div class="category-card" *ngFor="let category of filteredCategories" [class.inactive]="!category.isActive">
            <div class="category-header">
              <div class="category-icon" [style.background-color]="category.color">
                <span class="material-icons">{{ category.icon }}</span>
              </div>
              <div class="category-status" [class]="category.isActive ? 'active' : 'inactive'">
                <span class="material-icons">{{ category.isActive ? 'check_circle' : 'cancel' }}</span>
              </div>
            </div>
            
            <div class="category-content">
              <h3 class="category-name">{{ category.name }}</h3>
              <p class="category-description">{{ category.description }}</p>
              
              <div class="category-stats">
                <div class="stat-item">
                  <span class="material-icons">restaurant_menu</span>
                  <span class="stat-text">{{ getDishesCountByCategory(category.id) }} pratos</span>
                </div>
                <div class="stat-item">
                  <span class="material-icons">schedule</span>
                  <span class="stat-text">Criada {{ formatDate(category.createdAt) }}</span>
                </div>
              </div>
            </div>
            
            <div class="category-actions">
              <button class="action-btn edit" (click)="editCategory(category)" title="Editar">
                <span class="material-icons">edit</span>
              </button>
              <button 
                class="action-btn toggle" 
                (click)="toggleCategoryStatus(category)" 
                [title]="category.isActive ? 'Desativar' : 'Ativar'">
                <span class="material-icons">{{ category.isActive ? 'visibility_off' : 'visibility' }}</span>
              </button>
              <button class="action-btn delete" (click)="deleteCategory(category)" title="Excluir">
                <span class="material-icons">delete</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="filteredCategories.length === 0">
          <div class="empty-icon">
            <span class="material-icons">category</span>
          </div>
          <h3 class="empty-title">Nenhuma categoria encontrada</h3>
          <p class="empty-message">
            {{ searchTerm || selectedStatus ? 
               'Tente ajustar os filtros de busca.' : 
               'Comece criando sua primeira categoria.' }}
          </p>
          <button class="btn-primary" (click)="openAddCategoryModal()" *ngIf="!searchTerm && !selectedStatus">
            <span class="material-icons">add</span>
            Criar Primeira Categoria
          </button>
        </div>
      </div>

      <!-- Category Usage -->
      <div class="usage-section" *ngIf="categories.length > 0">
        <div class="section-header">
          <h2 class="section-title">Uso das Categorias</h2>
        </div>
        
        <div class="usage-chart">
          <div class="usage-item" *ngFor="let category of categories">
            <div class="usage-info">
              <div class="usage-icon" [style.background-color]="category.color">
                <span class="material-icons">{{ category.icon }}</span>
              </div>
              <div class="usage-details">
                <h4 class="usage-name">{{ category.name }}</h4>
                <p class="usage-count">{{ getDishesCountByCategory(category.id) }} pratos</p>
              </div>
            </div>
            <div class="usage-bar">
              <div class="usage-progress" 
                   [style.width.%]="getCategoryUsagePercentage(category.id)"
                   [style.background-color]="category.color"></div>
            </div>
            <div class="usage-percentage">
              {{ getCategoryUsagePercentage(category.id) }}%
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Add/Edit Category Modal -->
<div class="modal-overlay" *ngIf="showCategoryModal" (click)="closeCategoryModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">{{ editingCategory ? 'Editar Categoria' : 'Nova Categoria' }}</h2>
      <button class="modal-close" (click)="closeCategoryModal()">
        <span class="material-icons">close</span>
      </button>
    </div>
    
    <form class="category-form" (ngSubmit)="saveCategory()" #categoryForm="ngForm">
      <div class="form-grid">
        <div class="form-group">
          <label for="categoryName">Nome da Categoria *</label>
          <input 
            type="text" 
            id="categoryName" 
            name="categoryName"
            class="form-input"
            [(ngModel)]="categoryFormData.name"
            required
            placeholder="Ex: Pratos Principais">
        </div>
        
        <div class="form-group">
          <label for="categoryIcon">√çcone *</label>
          <select 
            id="categoryIcon" 
            name="categoryIcon"
            class="form-select"
            [(ngModel)]="categoryFormData.icon"
            required>
            <option value="">Selecione um √≠cone</option>
            <option value="restaurant">üçΩÔ∏è Restaurant</option>
            <option value="dinner_dining">üçñ Dinner</option>
            <option value="local_bar">üçπ Bebidas</option>
            <option value="cake">üç∞ Sobremesas</option>
            <option value="fastfood">üçî Fast Food</option>
            <option value="local_pizza">üçï Pizza</option>
            <option value="ramen_dining">üçú Sopas</option>
            <option value="icecream">üç¶ Sorvetes</option>
            <option value="coffee">‚òï Caf√©</option>
            <option value="wine_bar">üç∑ Vinhos</option>
          </select>
        </div>
      </div>
      
      <div class="form-group">
        <label for="categoryDescription">Descri√ß√£o *</label>
        <textarea 
          id="categoryDescription" 
          name="categoryDescription"
          class="form-textarea"
          [(ngModel)]="categoryFormData.description"
          required
          rows="3"
          placeholder="Descreva esta categoria e que tipos de pratos ela inclui..."></textarea>
      </div>
      
      <div class="form-group">
        <label for="categoryColor">Cor da Categoria *</label>
        <div class="color-picker">
          <input 
            type="color" 
            id="categoryColor" 
            name="categoryColor"
            class="color-input"
            [(ngModel)]="categoryFormData.color"
            required>
          <div class="color-preview" [style.background-color]="categoryFormData.color">
            <span class="material-icons" [style.color]="getContrastColor(categoryFormData.color)">
              {{ categoryFormData.icon || 'category' }}
            </span>
          </div>
          <div class="color-presets">
            <button 
              type="button" 
              class="color-preset" 
              *ngFor="let color of colorPresets"
              [style.background-color]="color"
              (click)="categoryFormData.color = color"
              [class.selected]="categoryFormData.color === color">
            </button>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            name="categoryActive"
            [(ngModel)]="categoryFormData.isActive">
          <span class="checkmark"></span>
          Categoria ativa (vis√≠vel no card√°pio)
        </label>
      </div>
      
      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeCategoryModal()">
          Cancelar
        </button>
        <button type="submit" class="btn-primary" [disabled]="!categoryForm.valid">
          <span class="material-icons">save</span>
          {{ editingCategory ? 'Salvar Altera√ß√µes' : 'Criar Categoria' }}
        </button>
      </div>
    </form>
  </div>
</div>

