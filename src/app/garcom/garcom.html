<div class="foodflow-container">
  
  <header class="top-bar">
    <div class="logo">
      <span class="icon">ğŸŒ¸</span> <h1>FoodFlow <small>GarÃ§om</small></h1>
    </div>
    <div class="search-bar">
      <span class="search-icon">ğŸ”</span>
      <input type="text" placeholder="Buscar mesa..." [(ngModel)]="termoBusca" (input)="atualizarLista()">
    </div>
  </header>

  <div class="actions-bar">
    <div class="filters">
      <button [class.active]="filtroStatus === 'todos'" (click)="filtrarPor('todos')">Todos</button>
      <button [class.active]="filtroStatus === 'ocupada'" (click)="filtrarPor('ocupada')">Ocupadas</button>
      <button [class.active]="filtroStatus === 'disponivel'" (click)="filtrarPor('disponivel')">Livres</button>
    </div>
  </div>

  <div class="mesas-grid">
    <div *ngFor="let mesa of mesasFiltradas" 
         class="mesa-card" 
         [class.chamando]="mesa.solicitou_atencao" 
         (click)="abrirDetalhes(mesa)">
      
      <div class="card-header" [ngClass]="getStatusClass(mesa.status)">
        <div class="status-indicator">
          <i class="fas" [ngClass]="{
            'fa-check-circle': mesa.status === 'disponivel',
            'fa-user-friends': mesa.status === 'ocupada',
            'fa-clock': mesa.status === 'reservada'
          }"></i>
          <span>{{ getStatusLabel(mesa.status) }}</span>
        </div>
        <div *ngIf="temPedidoPronto(mesa) && !mesa.solicitou_atencao" class="badge-ready">
          <i class="fas fa-bell"></i> Pronto
        </div>
      </div>
      
      <div class="card-body">
        <div *ngIf="mesa.solicitou_atencao" class="alert-calling">
          <i class="fas fa-hand-paper fa-bounce"></i>
          <span>Solicita Atendimento</span>
        </div>

        <div class="mesa-info" *ngIf="!mesa.solicitou_atencao">
          <h2>Mesa {{ mesa.numero }}</h2>
          <span class="garcom-name" *ngIf="mesa.garcom"><i class="fas fa-user-tie"></i> {{ mesa.garcom }}</span>
        </div>
        
        <div class="mesa-valor" *ngIf="!mesa.solicitou_atencao">
          <small>Total</small>
          <strong>R$ {{ mesa.valor_total_mesa | number:'1.2-2' }}</strong>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="mesaSelecionada" (click)="fecharDetalhes()">
    <div class="drawer" (click)="$event.stopPropagation()">
      
      <div class="drawer-header">
        <button class="btn-back" (click)="fecharDetalhes()">â† Voltar</button>
        <h3>Mesa {{ mesaSelecionada.numero }}</h3>
      </div>

      <div class="drawer-content">
        
        <div *ngIf="mesaSelecionada.solicitou_atencao" class="alert-box-drawer">
          <p><strong>Mesa pedindo ajuda!</strong></p>
          <button class="btn-attend" (click)="atenderChamado()">
            <i class="fas fa-check"></i> Atender Chamado
          </button>
        </div>

        <div *ngIf="getPedidosProntos(mesaSelecionada!).length > 0" class="alert-pronto">
            <h4><i class="fas fa-bell"></i> Prontos para Entrega</h4>
            <div *ngFor="let pedido of getPedidosProntos(mesaSelecionada!)" class="pedido-pronto-row">
                <span>Pedido #{{ pedido.id }}</span>
                <button class="btn-entregar" (click)="confirmarEntrega(pedido)">
                  <i class="fas fa-walking"></i> Entregar
                </button>
            </div>
        </div>

        <div class="item-row" *ngFor="let item of getItensDaMesa(mesaSelecionada!)">
          <div class="item-desc">
            <span class="qtd">{{ item.quantidade }}x</span>
            <span class="nome">{{ item.prato_nome }}</span>
          </div>
          <span class="preco">R$ {{ (item.preco_unitario * item.quantidade) | number:'1.2-2' }}</span>
        </div>
        
        <div class="empty-state" *ngIf="getItensDaMesa(mesaSelecionada!).length === 0">
          <p>Nenhum item lanÃ§ado.</p>
        </div>
      </div>

      <div class="drawer-footer">
        <div class="total-row">
            <span>Total:</span>
            <span class="total-value">R$ {{ mesaSelecionada.valor_total_mesa | number:'1.2-2' }}</span>
        </div>
        <div class="action-buttons">
            <button class="btn-action" style="background:#eee; color:#555; border: 1px solid #ccc" (click)="simularChamado()">
                ğŸ”” Simular Chamado (Teste)
            </button>

            <button *ngIf="mesaSelecionada.status === 'ocupada'" class="btn-action btn-release" (click)="liberarMesa()">
                ğŸ“¤ Fechar Conta / Liberar
            </button>
        </div>
      </div>

    </div>
  </div>
</div>